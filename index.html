<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TWZOO Sudoku</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon.png" />
  <style>
    :root{
      --bg:#fffafc; --ink:#2d2a32; --muted:#8b8b99; --brand:#6aa5ff; --accent:#5ea4ff;
      --cell:#fff; --cell-alt:#fff3f8; --given:#f1f5ff; --error:#ffe2e2; --ok:#e7ffe7;
      --grid:#f3b3cc; --subgrid:#e784a6; --shadow: 0 10px 30px rgba(0,0,0,.06);
    }
    :root{ --pink:#E784A6; --apricot:#fac796; }
    *{box-sizing:border-box}
    html,body{margin:0; height:100%; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "PingFang TC", Arial, sans-serif;}
    header{
      padding: calc(16px + env(safe-area-inset-top, 0px)) 16px 16px;
      border-bottom:1px solid #f0e3ea; background:#fff; position:sticky; top:0; z-index:2;
      will-change: transform;
    }
    @media (max-width: 640px){ header{ position: static; } }
    .head{display:flex; flex-direction:column; gap:8px; align-items:center; text-align:center}
    .title{font-weight:700; letter-spacing:.2px; color: var(--subgrid); font-size:22px}
    .subtitle{color:var(--muted); font-weight:500; font-size:13px}
    .actions{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center}
    .pill{font-size:12px; padding:6px 8px; border-radius:999px; border:1px solid #e8d3df; color:#6b6b77; background:#fff}
    button{border:1.5px solid #e8d3df; background:#fff; padding:9px 12px; border-radius:12px; cursor:pointer; font-weight:600}
    button:hover{background:#fff6fb}
    .primary{background:var(--brand); color:#fff; border-color:var(--brand)}

    main{max-width:1100px; margin:0 auto; padding:16px; display:flex; flex-direction:column; align-items:center; gap:12px;}

    /* 棋盤 */
    .board-wrap{background:#fff;border:2px solid #f0e3ea; border-radius:18px; padding:16px; box-shadow:var(--shadow); display:inline-block}
    .board{border:2.5px solid var(--subgrid); border-radius:12px; overflow:hidden}
    .cell{border:1.5px solid var(--grid); background:var(--cell); display:flex; align-items:center; justify-content:center; position:relative; user-select:none}
    .cell.alt{background:var(--cell-alt)}
    .cell.given{background:var(--given)}
    .cell.error{background:var(--error); box-shadow:0 0 0 3px #ef4444 inset;}
    .cell.error.hl{box-shadow:0 0 0 3px #ef4444 inset, 0 0 0 1.5px var(--accent) inset;} 
    .cell.ok{background:var(--ok)}
    .cell.hl{box-shadow:0 0 0 3px var(--accent) inset; position:relative}
    .cell img{max-width:80%; max-height:80%; pointer-events:none}
    .cell.thick-right{border-right:2.5px solid var(--subgrid)}
    .cell.thick-bottom{border-bottom:2.5px solid var(--subgrid)}

    /* 浮動選單（3x3） */
    .picker{position:absolute; z-index:5; display:grid; grid-template-columns:repeat(3,72px); gap:8px; padding:12px; background:#fff; border:2px solid #f0e3ea; border-radius:14px; box-shadow:var(--shadow)}
    .pick{width:72px; height:72px; display:flex; align-items:center; justify-content:center; border:1.5px dashed #e4c1d4; border-radius:12px; cursor:pointer; background:var(--cell-alt)}
    .pick img{max-width:92%; max-height:92%}
    .hidden{display:none}

    /* 狀態在棋盤下方 */
    .below{display:flex; justify-content:center; width:100%}
    .below .pill{background:#fff;}

    .progress{margin:2px 0 0; text-align:center; color:var(--muted); font-size:13px; width:100%}
    .version{margin:4px 0 0; text-align:center; color:var(--muted); font-size:12px; width:100%}

    /* 題目選擇器（1–9） */
    .puzzle-picker{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:4px}
    .pcell{width:44px;height:44px;border-radius:999px;font-weight:700;display:inline-flex;align-items:center;justify-content:center;line-height:1;border:2px solid transparent}
    .pcell.idle{border-color:var(--pink); color:var(--pink); background:#fff}
    .pcell.progress{background:var(--pink); color:#fff}
    .pcell.done{background:var(--apricot); color:#fff}
    .pcell.current{box-shadow:0 0 0 2px var(--apricot)}

    /* Footer */
    footer{margin:8px 0 24px; text-align:center; color:#6b6b77; font-size:14px; width:100%}

    /* Error overlay */
    #err{position:fixed; left:0; right:0; top:0; background:#ffeaea; color:#b00020; padding:10px 14px; border-bottom:2px solid #ffb3b3; font-size:12px; display:none; z-index:99}

    /* ====== RWD：1–9 題目按鈕在手機/平板縮小，桌機維持 ====== */
    @media (max-width: 430px) {
      .puzzle-picker { gap: 6px; flex-wrap: nowrap; }
      .pcell { width: 32px; height: 32px; font-size: 12px; }
    }
    @media (min-width: 431px) and (max-width: 768px) {
      .puzzle-picker { gap: 7px; }
      .pcell { width: 38px; height: 38px; font-size: 13px; }
    }
  </style>
</head>
<body>
  <div id="err"></div>
  <header>
    <div class="head">
      <div class="title">TWZOO Sudoku</div>
      <div class="subtitle" id="subtitle">點選空格會跳出選單、雙擊格子清除</div>
      <div class="actions">
        <button id="btnReset">重製題目</button>
      </div>
      <div id="puzzlePicker" class="puzzle-picker"></div>
    </div>
  </header>

  <main>
    <section class="board-wrap">
      <div id="board" class="board" aria-label="9x9 board"
           style="display:grid;grid-template-columns:repeat(9,1fr);gap:0;width:min(96vmin, calc(100vw - 24px), 960px)"></div>
    </section>

    <div cl
