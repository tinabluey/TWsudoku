<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TWZOO Sudoku</title>
  <meta name="theme-color" content="#ffffff" />
  <!-- 將在 JS 中把 favicon 設為 IMAGES[0]（預設為數字1的圓形；若有 images/1.png 會自動用你的貼圖） -->
  <!-- favicon：若根目錄有 Favicon.png 或 favicon.png 會優先使用；否則以 JS 動態設定 -->
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon.png" />
  <style>
    :root{
      --bg:#fffafc; --ink:#2d2a32; --muted:#8b8b99; --brand:#6aa5ff; --accent:#ffd166;
      --cell:#fff; --cell-alt:#fff3f8; --given:#f1f5ff; --error:#ffe2e2; --ok:#e7ffe7;
      --grid:#f3b3cc; --subgrid:#e784a6; --shadow: 0 10px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "PingFang TC", Arial, sans-serif; background:var(--bg); color:var(--ink);}    
    header{padding:14px 16px; display:flex; gap:12px; align-items:center; justify-content:space-between; border-bottom:1px solid #f0e3ea; background:#fff; position:sticky; top:0; z-index:2}
    header .title{font-weight:700; letter-spacing:.2px}
    header .title small{display:block; font-weight:500; color:var(--muted)}
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    button{border:1.5px solid #e8d3df; background:#fff; padding:9px 12px; border-radius:12px; cursor:pointer; font-weight:600}
    button:hover{background:#fff6fb}
    .primary{background:var(--brand); color:#fff; border-color:var(--brand)}

    main{max-width:720px; margin:0 auto; padding:18px}

    /* Board */
    .board-wrap{background:#fff;border:2px solid #f0e3ea; border-radius:18px; padding:16px; box-shadow:var(--shadow)}
    .board{display:grid; grid-template-columns:repeat(9, minmax(34px, 1fr)); gap:0; border:2.5px solid var(--subgrid); border-radius:12px; overflow:hidden}
    .cell{border:1.5px solid var(--grid); aspect-ratio:1; background:var(--cell); display:flex; align-items:center; justify-content:center; position:relative; user-select:none}
    .cell.alt{background:var(--cell-alt)}
    .cell.given{background:var(--given)}
    .cell.error{background:var(--error)}
    .cell.ok{background:var(--ok)}
    .cell.hl{box-shadow:0 0 0 3px var(--accent) inset; position:relative}
    .cell img{max-width:80%; max-height:80%; pointer-events:none}
    .cell .idx{position:absolute; left:6px; top:6px; font-size:10px; color:#caa}
    .cell.thick-right{border-right:2.5px solid var(--subgrid)}
    .cell.thick-bottom{border-bottom:2.5px solid var(--subgrid)}

    /* Picker */
    .picker{position:absolute; z-index:5; display:grid; grid-template-columns:repeat(3,56px); gap:8px; padding:10px; background:#fff; border:2px solid #f0e3ea; border-radius:14px; box-shadow:var(--shadow)}
    .pick{width:56px; height:56px; display:flex; align-items:center; justify-content:center; border:1.5px dashed #e4c1d4; border-radius:12px; cursor:pointer; background:var(--cell-alt)}
    .pick img{max-width:80%; max-height:80%}
    .hidden{display:none}

    .hint{margin:10px 4px; color:var(--muted); font-size:12px}

    @media (max-width:520px){
      .picker{grid-template-columns:repeat(3,48px)}
      .pick{width:48px; height:48px}
    }
  </style>
</head>
<body>
  <header>
    <div class="title">TWZOO Sudoku<small>點可編輯的格子，會跳出 3×3 圖像選單；雙擊格子清除。</small></div>
    <div class="controls">
      <button id="btnCheck" class="primary">檢查</button>
      <button id="btnReset">重置到題目</button>
    </div>
  </header>

  <main>
    <section class="board-wrap">
      <div id="board" class="board" aria-label="9x9 board"></div>
    </section>
    <div class="hint">提示：鍵盤 1–9 也可填入；Backspace 清除。題目內建不可移動的「已知格」。</div>
  </main>

  <!-- floating 3x3 image picker -->
  <div id="picker" class="picker hidden" role="dialog" aria-label="選擇圖像">
    <!-- picks injected by JS -->
  </div>

<script>
(() => {
  // ======= IMAGES：預設用彩色數字圓形；若 /images/1.png~9.png 存在會自動載入 =======
  const numberSVG = (n, bg) => `data:image/svg+xml;utf8,${encodeURIComponent(`
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'>
      <defs>
        <filter id='s' x='-20%' y='-20%' width='140%' height='140%'>
          <feDropShadow dx='0' dy='6' stdDeviation='6' flood-opacity='.18'/>
        </filter>
      </defs>
      <circle cx='100' cy='100' r='82' fill='${bg}' filter='url(%23s)'/>
      <text x='50%' y='54%' text-anchor='middle' dominant-baseline='middle' font-size='120' font-family='system-ui, sans-serif' fill='white' font-weight='800'>${n}</text>
    </svg>`)}`;
  const demoBG = ['#78a8ff','#ffa3a3','#ffc658','#9fe87f','#b996ff','#ff86d3','#7ad8ff','#ffb36a','#83e6d6'];
  let IMAGES = Array.from({length:9}, (_,i)=> numberSVG(i+1, demoBG[i]));
  async function autoLoadFromImagesFolder(){
    try{
      const loaders = Array.from({length:9}, (_,i)=> fetch(`images/${i+1}.png`).then(r=> r.ok? r.blob(): Promise.reject()).then(b=> new Promise(res=>{const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.readAsDataURL(b);})));    
      IMAGES = await Promise.all(loaders);
    }catch(e){ /* 保持數字 SVG 占位 */ }
  }

  // 動態設定 favicon：用 IMAGES[0]（若 /images/1.png 存在就會是你的貼圖）
  function setFaviconAuto(){
    const apply = (src)=>{
      const ensure = (rel) => {
        let link = document.querySelector(`link[rel="${rel}"]`);
        if (!link){ link = document.createElement('link'); link.rel = rel; document.head.appendChild(link); }
        return link;
      };
      ensure('icon').href = src;
      ensure('apple-touch-icon').href = src;
    };
    // 依序嘗試 Favicon.png → favicon.png → 退回第一張圖像
    (async () => {
    await autoLoadFromImagesFolder();
    setFaviconAuto();
    buildBoard();
    buildPicker();
  })();
})();
</script>
</body>
</html>
